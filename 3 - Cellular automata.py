"""
Assignment 3, by Leonardo Blas.
07/12/2019.
In this assignment we create a Cellular Automata program. We could use a list
of patterns for a simplified program, but that would limit us to a single
rule framework (only 3 bits possible, and we'd have to create a new program
for a 5 bits version).
rules[32] produces output but cannot confirm if it's correct, as finding an
output database for a 5-neighborhood system was extremely challenging.
"""

import math
import numpy as np


class NumError(Exception):
    pass


class Automaton:
    RULES_SIZE = 32
    BITS_IN_RULE_SIZE = int(math.log(RULES_SIZE, 2))
    MIN_DISPLAY_WIDTH = 20
    MAX_DISPLAY_WIDTH = 121
    DFLT_DISPLAY_WIDTH = 99
    MIN_RULE = 0
    MAX_RULE = 2 ** RULES_SIZE - 1  # 255 for us
    DFLT_RULE = 126
    ON_STR = "*"
    OFF_STR = " "

    def __init__(self, rule=DFLT_RULE):
        self.this_gen = self.ON_STR
        self.display_width = self.DFLT_DISPLAY_WIDTH
        self.extreme_bit = self.OFF_STR
        self.rule = np.zeros(self.RULES_SIZE, dtype=bool)
        self.set_rule(rule)
        self.reset_first_gen()

    def set_rule(self, rule):
        """
        rule's mutator.
        :param rule: int
        :return: bool
        """
        if type(rule) == int and self.MIN_RULE <= rule <= self.MAX_RULE:
            for i in range(self.RULES_SIZE):
                # If right shifted and first right digit is 1.
                if (rule >> i) & 1:
                    self.rule[i] = True
                else:
                    self.rule[i] = False
            return True
        raise NumError
        self.rule = self.DFLT_RULE
        return False

    def reset_first_gen(self):
        """
        Plant the seed.
        :return: none
        """
        self.this_gen = self.ON_STR
        self.extreme_bit = self.OFF_STR

    def propagate_new_generation(self):
        new_generation = ''
        # Determine how many extreme bits we need.
        extreme_bits = self.BITS_IN_RULE_SIZE // 2
        # Determine how many extreme_bits we append.
        for i in range(self.BITS_IN_RULE_SIZE - 1):
            self.this_gen = self.extreme_bit + self.this_gen + self.extreme_bit
        # Checking on current generation (without extremes).
        for i in range(extreme_bits, len(self.this_gen) - extreme_bits):
            # Using binary values to identify ON_STR indexes on this_gen.
            bit_position = 0
            bit_position_value = 1
            # Walking from RHS to LHS. Better, as binary numbers go this way.
            for j in range(extreme_bits + i, i - extreme_bits - 1, -1):
                if self.this_gen[j] == self.ON_STR:
                    bit_position += bit_position_value
                bit_position_value = bit_position_value * 2
            # Using indexes to append characters.
            if self.rule[bit_position]:
                new_generation += self.ON_STR
            else:
                new_generation += self.OFF_STR
        self.this_gen = new_generation
        # Setting the extremes up for the upcoming new generation.
        if self.extreme_bit == self.OFF_STR:
            extreme_bit_is_one = self.rule[0]
        else:
            extreme_bit_is_one = self.rule[self.RULES_SIZE - 1]
        if extreme_bit_is_one:
            self.extreme_bit = self.ON_STR
        else:
            self.extreme_bit = self.OFF_STR

    def to_string_current_gen(self):
        """
        to_string method for our class.
        :return: string
        """
        return_string = self.this_gen
        extremes_length = self.display_width - len(self.this_gen)
        half_extreme = extremes_length // 2
        # If this_gen > display_width.
        if extremes_length < 0:
            return_string = self.this_gen[-half_extreme:
                                          -half_extreme + self.display_width]
        # Otherwise, add more extremes.
        else:
            for i in range(half_extreme):
                return_string = self.extreme_bit + return_string + self.extreme_bit
        return return_string

    def set_display_width(self, width=DFLT_DISPLAY_WIDTH):
        """
        display_width's mutator.
        :param width: int
        :return: bool
        """
        # Check if width is odd.
        if type(width) == int and width & 1 \
                and self.MIN_DISPLAY_WIDTH <= width <= self.MAX_DISPLAY_WIDTH:
            self.display_width = width
            return True
        return False


def main():
    automaton = Automaton()
    try:
        rule = int(input(f'Enter Rule (0 - {Automaton.MAX_RULE}): '))
        automaton.set_rule(rule)
    except ValueError:
        print('Input is not an int.')
    except NumError:
        print(f'Input is not between (0 - {Automaton.MAX_RULE}).')
    print('   start')
    for i in range(50):
        print(automaton.to_string_current_gen())
        automaton.propagate_new_generation()
    print('   end')


if __name__ == '__main__':
    main()

"""
Enter Rule (0 - 255): 15
   start
                                                 *                                                 
************************************************** ************************************************
                                                   *                                               
**************************************************** **********************************************
                                                     *                                             
****************************************************** ********************************************
                                                       *                                           
******************************************************** ******************************************
                                                         *                                         
********************************************************** ****************************************
                                                           *                                       
************************************************************ **************************************
                                                             *                                     
************************************************************** ************************************
                                                               *                                   
**************************************************************** **********************************
                                                                 *                                 
****************************************************************** ********************************
                                                                   *                               
******************************************************************** ******************************
                                                                     *                             
********************************************************************** ****************************
                                                                       *                           
************************************************************************ **************************
                                                                         *                         
************************************************************************** ************************
                                                                           *                       
**************************************************************************** **********************
                                                                             *                     
****************************************************************************** ********************
                                                                               *                   
******************************************************************************** ******************
                                                                                 *                 
********************************************************************************** ****************
                                                                                   *               
************************************************************************************ **************
                                                                                     *             
************************************************************************************** ************
                                                                                       *           
**************************************************************************************** **********
                                                                                         *         
****************************************************************************************** ********
                                                                                           *       
******************************************************************************************** ******
                                                                                             *     
********************************************************************************************** ****
                                                                                               *   
************************************************************************************************ **
                                                                                                 * 
************************************************************************************************** 
   end

Process finished with exit code 0


Enter Rule (0 - 255): 218
   start
                                                 *                                                 
                                                * *                                                
                                               *   *                                               
                                              * * * *                                              
                                             *       *                                             
                                            * *     * *                                            
                                           *   *   *   *                                           
                                          * * * * * * * *                                          
                                         *               *                                         
                                        * *             * *                                        
                                       *   *           *   *                                       
                                      * * * *         * * * *                                      
                                     *       *       *       *                                     
                                    * *     * *     * *     * *                                    
                                   *   *   *   *   *   *   *   *                                   
                                  * * * * * * * * * * * * * * * *                                  
                                 *                               *                                 
                                * *                             * *                                
                               *   *                           *   *                               
                              * * * *                         * * * *                              
                             *       *                       *       *                             
                            * *     * *                     * *     * *                            
                           *   *   *   *                   *   *   *   *                           
                          * * * * * * * *                 * * * * * * * *                          
                         *               *               *               *                         
                        * *             * *             * *             * *                        
                       *   *           *   *           *   *           *   *                       
                      * * * *         * * * *         * * * *         * * * *                      
                     *       *       *       *       *       *       *       *                     
                    * *     * *     * *     * *     * *     * *     * *     * *                    
                   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *   *                   
                  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                  
                 *                                                               *                 
                * *                                                             * *                
               *   *                                                           *   *               
              * * * *                                                         * * * *              
             *       *                                                       *       *             
            * *     * *                                                     * *     * *            
           *   *   *   *                                                   *   *   *   *           
          * * * * * * * *                                                 * * * * * * * *          
         *               *                                               *               *         
        * *             * *                                             * *             * *        
       *   *           *   *                                           *   *           *   *       
      * * * *         * * * *                                         * * * *         * * * *      
     *       *       *       *                                       *       *       *       *     
    * *     * *     * *     * *                                     * *     * *     * *     * *    
   *   *   *   *   *   *   *   *                                   *   *   *   *   *   *   *   *   
  * * * * * * * * * * * * * * * *                                 * * * * * * * * * * * * * * * *  
 *                               *                               *                               * 
* *                             * *                             * *                             * *
   end

Process finished with exit code 0

Enter Rule (0 - 255): 250
   start
                                                 *                                                 
                                                * *                                                
                                               * * *                                               
                                              * * * *                                              
                                             * * * * *                                             
                                            * * * * * *                                            
                                           * * * * * * *                                           
                                          * * * * * * * *                                          
                                         * * * * * * * * *                                         
                                        * * * * * * * * * *                                        
                                       * * * * * * * * * * *                                       
                                      * * * * * * * * * * * *                                      
                                     * * * * * * * * * * * * *                                     
                                    * * * * * * * * * * * * * *                                    
                                   * * * * * * * * * * * * * * *                                   
                                  * * * * * * * * * * * * * * * *                                  
                                 * * * * * * * * * * * * * * * * *                                 
                                * * * * * * * * * * * * * * * * * *                                
                               * * * * * * * * * * * * * * * * * * *                               
                              * * * * * * * * * * * * * * * * * * * *                              
                             * * * * * * * * * * * * * * * * * * * * *                             
                            * * * * * * * * * * * * * * * * * * * * * *                            
                           * * * * * * * * * * * * * * * * * * * * * * *                           
                          * * * * * * * * * * * * * * * * * * * * * * * *                          
                         * * * * * * * * * * * * * * * * * * * * * * * * *                         
                        * * * * * * * * * * * * * * * * * * * * * * * * * *                        
                       * * * * * * * * * * * * * * * * * * * * * * * * * * *                       
                      * * * * * * * * * * * * * * * * * * * * * * * * * * * *                      
                     * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                     
                    * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                    
                   * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                   
                  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                  
                 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                 
                * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                
               * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *               
              * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *              
             * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
            * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *            
           * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
          * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *          
         * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
        * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *        
       * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       
      * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *      
     * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     
    * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *    
   * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   
  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   end

Process finished with exit code 0

Enter Rule (0 - 255): 124
   start
                                                 *                                                 
                                                 **                                                
                                                 ***                                               
                                                 * **                                              
                                                 *****                                             
                                                 *   **                                            
                                                 **  ***                                           
                                                 *** * **                                          
                                                 * *******                                         
                                                 ***     **                                        
                                                 * **    ***                                       
                                                 *****   * **                                      
                                                 *   **  *****                                     
                                                 **  *** *   **                                    
                                                 *** * ****  ***                                   
                                                 * *****  ** * **                                  
                                                 ***   ** ********                                 
                                                 * **  ****      **                                
                                                 ***** *  **     ***                               
                                                 *   **** ***    * **                              
                                                 **  *  *** **   *****                             
                                                 *** ** * *****  *   **                            
                                                 * ********   ** **  ***                           
                                                 ***      **  ****** * **                          
                                                 * **     *** *    *******                         
                                                 *****    * ****   *     **                        
                                                 *   **   ***  **  **    ***                       
                                                 **  ***  * ** *** ***   * **                      
                                                 *** * ** ****** *** **  *****                     
                                                 * ********    *** ***** *   **                    
                                                 ***      **   * ***   ****  ***                   
                                                 * **     ***  *** **  *  ** * **                  
                                                 *****    * ** * ***** ** ********                 
                                                 *   **   ********   ******      **                
                                                 **  ***  *      **  *    **     ***               
                                                 *** * ** **     *** **   ***    * **              
                                                 * **********    * *****  * **   *****             
                                                 ***        **   ***   ** *****  *   **            
                                                 * **       ***  * **  ****   ** **  ***           
                                                 *****      * ** ***** *  **  ****** * **          
                                                 *   **     ******   **** *** *    *******         
                                                 **  ***    *    **  *  *** ****   *     **        
                                                 *** * **   **   *** ** * ***  **  **    ***       
                                                 * *******  ***  * ******** ** *** ***   * **      
                                                 ***     ** * ** ***      ****** *** **  *****     
                                                 * **    ********* **     *    *** ***** *   **    
                                                 *****   *       *****    **   * ***   ****  ***   
                                                 *   **  **      *   **   ***  *** **  *  ** * **  
                                                 **  *** ***     **  ***  * ** * ***** ** ******** 
                                                 *** * *** **    *** * ** ********   ******      **
   end

Process finished with exit code 0

----------------------------------------
----------rule[32] sample run:----------
----------------------------------------

Enter Rule (0 - 4294967295): 15
   start
                                                 *                                                 
*************************************************   ***********************************************
                                                   *                                               
***************************************************   *********************************************
                                                     *                                             
*****************************************************   *******************************************
                                                       *                                           
*******************************************************   *****************************************
                                                         *                                         
*********************************************************   ***************************************
                                                           *                                       
***********************************************************   *************************************
                                                             *                                     
*************************************************************   ***********************************
                                                               *                                   
***************************************************************   *********************************
                                                                 *                                 
*****************************************************************   *******************************
                                                                   *                               
*******************************************************************   *****************************
                                                                     *                             
*********************************************************************   ***************************
                                                                       *                           
***********************************************************************   *************************
                                                                         *                         
*************************************************************************   ***********************
                                                                           *                       
***************************************************************************   *********************
                                                                             *                     
*****************************************************************************   *******************
                                                                               *                   
*******************************************************************************   *****************
                                                                                 *                 
*********************************************************************************   ***************
                                                                                   *               
***********************************************************************************   *************
                                                                                     *             
*************************************************************************************   ***********
                                                                                       *           
***************************************************************************************   *********
                                                                                         *         
*****************************************************************************************   *******
                                                                                           *       
*******************************************************************************************   *****
                                                                                             *     
*********************************************************************************************   ***
                                                                                               *   
***********************************************************************************************   *
                                                                                                 * 
*************************************************************************************************  
   end

Process finished with exit code 0

----------------------------------------
----------rule[32] sample run:----------
----------------------------------------

Enter Rule (0 - 4294967295): 218
   start
                                                 *                                                 
                                               * *                                                 
                                             *                                                     
                                           * *                                                     
                                         *                                                         
                                       * *                                                         
                                     *                                                             
                                   * *                                                             
                                 *                                                                 
                               * *                                                                 
                             *                                                                     
                           * *                                                                     
                         *                                                                         
                       * *                                                                         
                     *                                                                             
                   * *                                                                             
                 *                                                                                 
               * *                                                                                 
             *                                                                                     
           * *                                                                                     
         *                                                                                         
       * *                                                                                         
     *                                                                                             
   * *                                                                                             
 *                                                                                                 
 *                                                                                                 
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
   end

Process finished with exit code 0

----------------------------------------
----------rule[32] sample run:----------
----------------------------------------

Enter Rule (0 - 4294967295): 250
   start
                                                 *                                                 
                                               * *                                                 
                                             * *                                                   
                                           * *                                                     
                                         * *                                                       
                                       * *                                                         
                                     * *                                                           
                                   * *                                                             
                                 * *                                                               
                               * *                                                                 
                             * *                                                                   
                           * *                                                                     
                         * *                                                                       
                       * *                                                                         
                     * *                                                                           
                   * *                                                                             
                 * *                                                                               
               * *                                                                                 
             * *                                                                                   
           * *                                                                                     
         * *                                                                                       
       * *                                                                                         
     * *                                                                                           
   * *                                                                                             
 * *                                                                                               
 *                                                                                                 
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
   end

Process finished with exit code 0


ERROR IN THE SPECS: 15 doesn't produce the same output, 18 does.
----------------------------------------
----------rule[32] sample run:----------
----------------------------------------

Enter Rule (0 - 4294967295): 18
   start
                                                 *                                                 
                                               * *                                                 
                                             *                                                     
                                           * *                                                     
                                         *                                                         
                                       * *                                                         
                                     *                                                             
                                   * *                                                             
                                 *                                                                 
                               * *                                                                 
                             *                                                                     
                           * *                                                                     
                         *                                                                         
                       * *                                                                         
                     *                                                                             
                   * *                                                                             
                 *                                                                                 
               * *                                                                                 
             *                                                                                     
           * *                                                                                     
         *                                                                                         
       * *                                                                                         
     *                                                                                             
   * *                                                                                             
 *                                                                                                 
 *                                                                                                 
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
                                                                                                   
   end

Process finished with exit code 0


----------------------------------------
----------rule[32] sample run:----------
----------------------------------------
Enter Rule (0 - 4294967295): 987654159
   start
                                                 *                                                 
*************************************************   ***********************************************
                                                * **                                               
************************************************ **   *********************************************
                                               ***  **                                             
*********************************************** ****    *******************************************
                                              ***  *  **                                           
********************************************** ****  *    *****************************************
                                             ***  ***   **                                         
********************************************* **** ** **    ***************************************
                                            ***  ******   **                                       
******************************************** ****     * **    *************************************
                                           ***  *  *** **   **                                     
******************************************* ****  * ****  **    ***********************************
                                          ***  *** **  ***    **                                   
****************************************** **** **** ** **  **    *********************************
                                         ***  ***  ****** **    **                                 
***************************************** **** ****     ***   **    *******************************
                                        ***  ***  *  *** ** **    **                               
**************************************** **** ****  * *******   **    *****************************
                                       ***  ***  *** **     * **    **                             
*************************************** **** **** ****   *** **   **    ***************************
                                      ***  ***  ***  * ** ****  **    **                           
************************************** **** **** **** *****  ***    **    *************************
                                     ***  ***  ***  ***   *** **  **    **                         
************************************* **** **** **** ** ** **** **    **    ***********************
                                    ***  ***  ***  *********  ***   **    **                       
************************************ **** **** ****        *** ** **    **    *********************
                                   ***  ***  ***  *  ****** *******   **    **                     
*********************************** **** **** ****  *     ***     * **    **    *******************
                                  ***  ***  ***  ***   *** **  *** **   **    **                   
********************************** **** **** **** ** ** **** ** ****  **    **    *****************
                                 ***  ***  ***  *********  ******  ***    **    **                 
********************************* **** **** ****        ***     *** **  **    **    ***************
                                ***  ***  ***  *  ****** **  *** **** **    **    **               
******************************** **** **** ****  *     *** ** ****  ***   **    **    *************
                               ***  ***  ***  ***   *** *******  *** ** **    **    **             
******************************* **** **** **** ** ** ****     *** *******   **    **    ***********
                              ***  ***  ***  *********  *  *** ****     * **    **    **           
****************************** **** **** ****        ***  * ****  *  *** **   **    **    *********
                             ***  ***  ***  *  ****** **** **  ***  * ****  **    **    **         
***************************** **** **** ****  *     ***  *** ** **** **  ***    **    **    *******
                            ***  ***  ***  ***   *** **** *******  *** ** **  **    **    **       
**************************** **** **** **** ** ** ****  ***     *** ******* **    **    **    *****
                           ***  ***  ***  *********  *** **  *** ****     ***   **    **    **     
*************************** **** **** ****        *** **** ** ****  *  *** ** **    **    **    ***
                          ***  ***  ***  *  ****** ****  ******  ***  * *******   **    **    **   
************************** **** **** ****  *     ***  ***     *** **** **     * **    **    **    *
                         ***  ***  ***  ***   *** **** **  *** ****  ***   *** **   **    **    ** 
************************* **** **** **** ** ** ****  *** ** ****  *** ** ** ****  **    **    **   
   end

Process finished with exit code 0

"""
